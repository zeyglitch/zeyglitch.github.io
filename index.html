<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Series Tracker</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #6a11cb;
            --secondary-color: #2575fc;
            --background-color: #f8f9fa;
            --card-color: #ffffff;
            --text-color: #333333;
            --border-color: #dddddd;
            --finished-color: #4caf50;
            --ongoing-color: #2196f3;
            --todo-color: #ff9800;
            --dropped-color: #f44336;
            --edit-color: #ff9800;
            --delete-color: #ff4d4d;
            --scrollbar-color: #cccccc;
            --scrollbar-hover-color: #aaaaaa;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--background-color);
            color: var(--text-color);
            padding: 10px;
            min-height: 100vh;
            background: linear-gradient(to bottom, var(--primary-color), var(--secondary-color));
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: var(--card-color);
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        header {
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 15px;
            text-align: center;
        }

        h1 {
            margin-bottom: 10px;
            font-size: 1.5rem;
        }

        .tabs {
            display: flex;
            background-color: rgba(255, 255, 255, 0.1);
            border-bottom: 1px solid var(--border-color);
            overflow-x: auto;
            white-space: nowrap;
        }

        .tab {
            padding: 12px 15px;
            cursor: pointer;
            text-align: center;
            transition: background-color 0.3s;
            font-weight: bold;
            flex: 1;
            min-width: 80px;
        }

        .tab:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .tab.active {
            background-color: rgba(255, 255, 255, 0.3);
            border-bottom: 3px solid white;
        }

        .content {
            padding: 15px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Conteneur de catégories avec défilement horizontal */
        .categories-container {
            display: flex;
            overflow-x: auto;
            gap: 15px;
            padding-bottom: 15px;
            margin-bottom: 20px;
            scrollbar-width: thin;
            scrollbar-color: var(--scrollbar-color) transparent;
        }

        .categories-container::-webkit-scrollbar {
            height: 6px;
        }

        .categories-container::-webkit-scrollbar-track {
            background: transparent;
            border-radius: 10px;
        }

        .categories-container::-webkit-scrollbar-thumb {
            background-color: var(--scrollbar-color);
            border-radius: 10px;
        }

        .categories-container::-webkit-scrollbar-thumb:hover {
            background-color: var(--scrollbar-hover-color);
        }

        .category {
            background-color: var(--card-color);
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 12px;
            min-width: 280px;
            flex: 0 0 auto;
        }

        .category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border-color);
        }

        .category-title {
            font-size: 1.1rem;
            font-weight: bold;
            color: var(--primary-color);
        }

        .delete-category {
            background: none;
            border: none;
            color: var(--delete-color);
            cursor: pointer;
            font-size: 1.1rem;
            padding: 4px;
        }

        /* Liste de séries avec défilement vertical */
        .series-list {
            list-style-type: none;
            max-height: 350px;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: var(--scrollbar-color) transparent;
        }

        .series-list::-webkit-scrollbar {
            width: 6px;
        }

        .series-list::-webkit-scrollbar-track {
            background: transparent;
            border-radius: 10px;
        }

        .series-list::-webkit-scrollbar-thumb {
            background-color: var(--scrollbar-color);
            border-radius: 10px;
        }

        .series-list::-webkit-scrollbar-thumb:hover {
            background-color: var(--scrollbar-hover-color);
        }

        .series-item {
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 8px;
            background-color: #f9f9f9;
            border-left: 4px solid var(--ongoing-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: transform 0.2s;
            position: relative;
        }

        .series-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .series-info {
            flex: 1;
            min-width: 0;
        }

        .series-name {
            font-weight: bold;
            margin-bottom: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            cursor: pointer;
            padding: 2px 4px;
            border-radius: 4px;
            transition: background-color 0.2s;
        }

        .series-name:hover {
            background-color: #eaeaea;
        }

        .series-counters {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 5px;
        }

        .counter-group {
            display: flex;
            align-items: center;
            background: #f0f0f0;
            padding: 4px 8px;
            border-radius: 12px;
        }

        .counter-label {
            font-size: 0.8rem;
            margin-right: 5px;
            color: #666;
            white-space: nowrap;
        }

        .counter-controls {
            display: flex;
            align-items: center;
        }

        .counter-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            font-size: 0.8rem;
        }

        .counter-value {
            margin: 0 6px;
            font-weight: bold;
            cursor: pointer;
            padding: 2px 6px;
            border-radius: 4px;
            transition: background-color 0.2s;
            min-width: 20px;
            text-align: center;
        }

        .counter-value:hover {
            background-color: #eaeaea;
        }

        .counter-input {
            width: 50px;
            padding: 2px 5px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            text-align: center;
            font-weight: bold;
        }

        .series-status {
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            color: white;
            cursor: pointer;
            margin-right: 8px;
            white-space: nowrap;
        }

        .status-finished {
            background-color: var(--finished-color);
        }

        .status-ongoing {
            background-color: var(--ongoing-color);
        }

        .status-todo {
            background-color: var(--todo-color);
        }

        .status-dropped {
            background-color: var(--dropped-color);
        }

        .series-actions {
            display: flex;
            align-items: center;
        }

        .edit-series {
            background: none;
            border: none;
            color: var(--edit-color);
            cursor: pointer;
            font-size: 1rem;
            padding: 4px;
            margin-right: 5px;
        }

        .delete-series {
            background: none;
            border: none;
            color: var(--delete-color);
            cursor: pointer;
            font-size: 1rem;
            padding: 4px;
        }

        .actions {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            gap: 10px;
            margin-top: 20px;
            padding: 12px;
            background-color: #f5f5f5;
            border-radius: 8px;
        }

        .btn {
            padding: 8px 12px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
            flex: 1;
            min-width: 140px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--secondary-color);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 15px;
        }

        .modal-content {
            background-color: var(--card-color);
            padding: 20px;
            border-radius: 8px;
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }

        .close {
            font-size: 1.5rem;
            cursor: pointer;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            font-size: 1rem;
        }

        .counter-fields {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .filters {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            margin-bottom: 15px;
            align-items: center;
            gap: 10px;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 8px;
            flex: 1;
            min-width: 150px;
        }

        .filter-group label {
            margin-bottom: 0;
            white-space: nowrap;
        }

        .empty-state {
            text-align: center;
            padding: 20px;
            color: #777;
        }

        /* Styles spécifiques pour mobile */
        @media (max-width: 768px) {
            body {
                padding: 5px;
            }
            
            .container {
                border-radius: 8px;
            }
            
            header {
                padding: 12px;
            }
            
            h1 {
                font-size: 1.3rem;
            }
            
            .tab {
                padding: 10px 12px;
                font-size: 0.9rem;
                min-width: 70px;
            }
            
            .content {
                padding: 10px;
            }
            
            .category {
                min-width: 260px;
                padding: 10px;
            }
            
            .series-item {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .series-counters {
                flex-direction: column;
                gap: 5px;
                width: 100%;
            }
            
            .counter-group {
                width: 100%;
                justify-content: space-between;
            }
            
            .series-actions {
                margin-top: 8px;
                align-self: stretch;
                justify-content: space-between;
                border-top: 1px dashed #ddd;
                padding-top: 8px;
            }
            
            .btn {
                min-width: 120px;
                padding: 8px 10px;
                font-size: 0.9rem;
            }
            
            .filters {
                flex-direction: column;
                align-items: stretch;
            }
            
            .filter-group {
                justify-content: space-between;
            }
            
            .counter-fields {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .tab {
                min-width: 60px;
                padding: 8px 10px;
                font-size: 0.8rem;
            }
            
            .category {
                min-width: 240px;
            }
            
            .actions {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
        }

        /* Ajoutez ces styles pour les boutons de synchronisation */
        .sync-section {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
            padding: 10px;
            background-color: #eef5ff;
            border-radius: 8px;
        }
        
        .sync-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .sync-google {
            background-color: #4285f4;
            color: white;
        }
        
        .sync-local {
            background-color: #34a853;
            color: white;
        }
        
        .sync-status {
            text-align: center;
            margin-top: 5px;
            font-size: 0.9rem;
            color: #666;
        }

        
        .auth-container {
            text-align: center;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
            margin: 20px;
        }
        
        .auth-btn {
            background-color: #4285f4;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }
        
        .auth-status {
            margin-top: 15px;
            font-size: 14px;
            color: #666;
        }
        
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>My Series Tracker</h1>
            <div class="tabs">
                <div class="tab active" data-tab="manwha">Manwha</div>
                <div class="tab" data-tab="manga">Manga</div>
                <div class="tab" data-tab="anime">Anime</div>
                <div class="tab" data-tab="novel">Novel</div>
            </div>
        </header>

        <div class="content">
            <div class="filters">
                <div class="filter-group">
                    <label for="status-filter">Filtrer par statut:</label>
                    <select id="status-filter">
                        <option value="all">Tous</option>
                        <option value="ongoing">En cours</option>
                        <option value="todo">À lire</option>
                        <option value="finished">Terminé</option>
                        <option value="dropped">Abandonné</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="sort">Trier par:</label>
                    <select id="sort">
                        <option value="last-updated">Dernière modification</option>
                        <option value="name">Nom</option>
                    </select>
                </div>
            </div>

            <div class="tab-content active" id="manwha-content">
                <div class="categories-container">
                    <!-- Catégories de manwha générées dynamiquement -->
                </div>
            </div>

            <div class="tab-content" id="manga-content">
                <div class="categories-container">
                    <!-- Catégories de manga générées dynamiquement -->
                </div>
            </div>

            <div class="tab-content" id="anime-content">
                <div class="categories-container">
                    <!-- Catégories d'anime générées dynamiquement -->
                </div>
            </div>

            <div class="tab-content" id="novel-content">
                <div class="categories-container">
                    <!-- Catégories de novel générées dynamiquement -->
                </div>
            </div>

            <div class="actions">
                <button class="btn btn-primary" id="add-category">
                    <i class="fas fa-plus"></i> Ajouter un thème
                </button>
                <button class="btn btn-primary" id="add-series">
                    <i class="fas fa-plus"></i> Ajouter une série
                </button>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div class="modal" id="category-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Ajouter un thème</h2>
                <span class="close">&times;</span>
            </div>
            <form id="category-form">
                <div class="form-group">
                    <label for="category-type">Type:</label>
                    <select id="category-type" required>
                        <option value="manwha">Manwha</option>
                        <option value="manga">Manga</option>
                        <option value="anime">Anime</option>
                        <option value="novel">Novel</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="category-name">Nom du thème:</label>
                    <input type="text" id="category-name" required>
                </div>
                <button type="submit" class="btn btn-primary">Ajouter</button>
            </form>
        </div>
    </div>

    <div class="modal" id="series-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Ajouter une série</h2>
                <span class="close">&times;</span>
            </div>
            <form id="series-form">
                <div class="form-group">
                    <label for="series-type">Type:</label>
                    <select id="series-type" required>
                        <option value="manwha">Manwha</option>
                        <option value="manga">Manga</option>
                        <option value="anime">Anime</option>
                        <option value="novel">Novel</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="series-category">Thème:</label>
                    <select id="series-category" required>
                        <!-- Options générées dynamiquement -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="series-name">Nom de la série:</label>
                    <input type="text" id="series-name" required>
                </div>
                <div class="form-group">
                    <label>Progression:</label>
                    <div class="counter-fields">
                        <div>
                            <label for="series-counter1">Type:</label>
                            <select id="series-counter1-type">
                                <option value="chapters">Chapitres</option>
                                <option value="seasons">Saisons</option>
                                <option value="volumes">Volumes</option>
                            </select>
                        </div>
                        <div>
                            <label for="series-counter1">Valeur:</label>
                            <input type="number" id="series-counter1" value="0" min="0">
                        </div>
                        <div id="counter2-container" style="display: none;">
                            <label for="series-counter2-type">Type secondaire:</label>
                            <select id="series-counter2-type">
                                <option value="episodes">Épisodes</option>
                                <option value="chapters">Chapitres</option>
                            </select>
                        </div>
                        <div id="counter2-value-container" style="display: none;">
                            <label for="series-counter2">Valeur secondaire:</label>
                            <input type="number" id="series-counter2" value="0" min="0">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="series-status">Statut:</label>
                    <select id="series-status" required>
                        <option value="ongoing">En cours</option>
                        <option value="todo">À lire</option>
                        <option value="finished">Terminé</option>
                        <option value="dropped">Abandonné</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary">Ajouter</button>
            </form>
        </div>
    </div>

    <div class="modal" id="delete-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Confirmer la suppression</h2>
                <span class="close">&times;</span>
            </div>
            <div class="form-group">
                <p id="delete-message">Êtes-vous sûr de vouloir supprimer cette série?</p>
            </div>
            <div style="display: flex; justify-content: space-between;">
                <button class="btn" id="cancel-delete" style="background-color: #ccc;">Annuler</button>
                <button class="btn" id="confirm-delete" style="background-color: var(--delete-color); color: white;">Supprimer</button>
            </div>
        </div>
    </div>

    <div class="modal" id="counter-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Modifier la progression</h2>
                <span class="close">&times;</span>
            </div>
            <div class="form-group">
                <label id="counter1-label" for="counter1-input">Saisons:</label>
                <input type="number" id="counter1-input" min="0" class="counter-input">
            </div>
            <div class="form-group" id="counter2-modal-group">
                <label id="counter2-label" for="counter2-input">Épisodes:</label>
                <input type="number" id="counter2-input" min="0" class="counter-input">
            </div>
            <div style="display: flex; justify-content: space-between;">
                <button class="btn" id="cancel-counter" style="background-color: #ccc;">Annuler</button>
                <button class="btn btn-primary" id="save-counter">Enregistrer</button>
            </div>
        </div>
    </div>

    <div class="modal" id="edit-series-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Modifier la série</h2>
                <span class="close">&times;</span>
            </div>
            <form id="edit-series-form">
                <div class="form-group">
                    <label for="edit-series-name">Nom de la série:</label>
                    <input type="text" id="edit-series-name" required>
                </div>
                <div class="form-group">
                    <label>Progression:</label>
                    <div class="counter-fields">
                        <div>
                            <label for="edit-counter1-type">Type:</label>
                            <select id="edit-counter1-type">
                                <option value="chapters">Chapitres</option>
                                <option value="seasons">Saisons</option>
                                <option value="volumes">Volumes</option>
                            </select>
                        </div>
                        <div>
                            <label for="edit-counter1-value">Valeur:</label>
                            <input type="number" id="edit-counter1-value" value="0" min="0">
                        </div>
                        <div id="edit-counter2-container">
                            <label for="edit-counter2-type">Type secondaire:</label>
                            <select id="edit-counter2-type">
                                <option value="episodes">Épisodes</option>
                                <option value="chapters">Chapitres</option>
                            </select>
                        </div>
                        <div id="edit-counter2-value-container">
                            <label for="edit-counter2-value">Valeur secondaire:</label>
                            <input type="number" id="edit-counter2-value" value="0" min="0">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="edit-series-status">Statut:</label>
                    <select id="edit-series-status" required>
                        <option value="ongoing">En cours</option>
                        <option value="todo">À lire</option>
                        <option value="finished">Terminé</option>
                        <option value="dropped">Abandonné</option>
                    </select>
                </div>
                <div style="display: flex; justify-content: space-between;">
                    <button type="button" class="btn" id="cancel-edit-series" style="background-color: #ccc;">Annuler</button>
                    <button type="submit" class="btn btn-primary">Enregistrer</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Données de l'application
        let appData = {
            manwha: {
                romance: [
                    { id: 1, name: "True Beauty", counter1Type: "chapters", counter1Value: 50, counter2Type: null, counter2Value: null, status: "ongoing", lastUpdated: Date.now() }
                ],
                action: [
                    { id: 2, name: "Solo Leveling", counter1Type: "chapters", counter1Value: 120, counter2Type: null, counter2Value: null, status: "finished", lastUpdated: Date.now() - 100000 }
                ]
            },
            manga: {
                romance: [
                    { id: 3, name: "Fruits Basket", counter1Type: "chapters", counter1Value: 136, counter2Type: null, counter2Value: null, status: "finished", lastUpdated: Date.now() - 200000 }
                ],
                murim: [
                    { id: 4, name: "Gosu", counter1Type: "chapters", counter1Value: 80, counter2Type: null, counter2Value: null, status: "ongoing", lastUpdated: Date.now() - 300000 }
                ]
            },
            anime: {
                action: [
                    { id: 5, name: "Attack on Titan", counter1Type: "seasons", counter1Value: 4, counter2Type: "episodes", counter2Value: 25, status: "finished", lastUpdated: Date.now() - 400000 }
                ]
            },
            novel: {
                fantasy: [
                    { id: 6, name: "The Beginning After the End", counter1Type: "volumes", counter1Value: 10, counter2Type: "chapters", counter2Value: 350, status: "ongoing", lastUpdated: Date.now() - 500000 }
                ]
            }
        };

        // Variables pour gérer la suppression et l'édition
        let seriesToDelete = null;
        let categoryToDelete = null;
        let seriesToEditCounter = null;
        let seriesToEdit = null;

        // Ordre de tri des statuts
        const statusOrder = {
            "ongoing": 0,
            "todo": 1,
            "finished": 2,
            "dropped": 3
        };

        // Charger les données depuis le localStorage si disponibles
        function loadData() {
            const savedData = localStorage.getItem('seriesTrackerData');
            if (savedData) {
                appData = JSON.parse(savedData);
            }
        }

        // Sauvegarder les données dans le localStorage
        function saveData() {
            localStorage.setItem('seriesTrackerData', JSON.stringify(appData));
        }

        // Générer un ID unique pour une nouvelle série
        function generateId() {
            return Date.now();
        }

        // Obtenir le texte du compteur en fonction du type
        function getCounterText(counterType) {
            const counterMap = {
                'chapters': 'Ch',
                'seasons': 'S',
                'volumes': 'V',
                'episodes': 'E'
            };
            return counterMap[counterType] || counterType;
        }

        // Obtenir le texte complet du compteur
        function getFullCounterText(counterType) {
            const counterMap = {
                'chapters': 'Chapitres',
                'seasons': 'Saisons',
                'volumes': 'Volumes',
                'episodes': 'Épisodes'
            };
            return counterMap[counterType] || counterType;
        }

        // Obtenir le texte du statut
        function getStatusText(status) {
            const statusMap = {
                'ongoing': 'En cours',
                'finished': 'Terminé',
                'todo': 'À lire',
                'dropped': 'Abandonné'
            };
            return statusMap[status] || status;
        }

        // Afficher les catégories et séries
        function renderCategories() {
            const tabs = ['manwha', 'manga', 'anime', 'novel'];
            
            tabs.forEach(tab => {
                const contentElement = document.getElementById(`${tab}-content`);
                const categoriesContainer = contentElement.querySelector('.categories-container');
                categoriesContainer.innerHTML = '';
                
                if (appData[tab] && Object.keys(appData[tab]).length > 0) {
                    for (const [categoryName, series] of Object.entries(appData[tab])) {
                        const categoryElement = document.createElement('div');
                        categoryElement.className = 'category';
                        
                        const categoryHeader = document.createElement('div');
                        categoryHeader.className = 'category-header';
                        
                        const categoryTitle = document.createElement('div');
                        categoryTitle.className = 'category-title';
                        categoryTitle.textContent = categoryName;
                        
                        const deleteCategoryBtn = document.createElement('button');
                        deleteCategoryBtn.className = 'delete-category';
                        deleteCategoryBtn.innerHTML = '<i class="fas fa-trash"></i>';
                        deleteCategoryBtn.addEventListener('click', () => {
                            confirmDeleteCategory(tab, categoryName);
                        });
                        
                        categoryHeader.appendChild(categoryTitle);
                        categoryHeader.appendChild(deleteCategoryBtn);
                        categoryElement.appendChild(categoryHeader);
                        
                        const seriesList = document.createElement('ul');
                        seriesList.className = 'series-list';
                        
                        // Filtrer et trier les séries
                        const statusFilter = document.getElementById('status-filter').value;
                        const sortBy = document.getElementById('sort').value;
                        
                        let filteredSeries = [...series];
                        
                        if (statusFilter !== 'all') {
                            filteredSeries = filteredSeries.filter(s => s.status === statusFilter);
                        } else {
                            // Tri personnalisé pour "Tous": En cours -> À lire -> Terminé -> Abandonné
                            filteredSeries.sort((a, b) => {
                                if (sortBy === 'last-updated') {
                                    if (statusOrder[a.status] === statusOrder[b.status]) {
                                        return b.lastUpdated - a.lastUpdated;
                                    }
                                    return statusOrder[a.status] - statusOrder[b.status];
                                } else {
                                    if (statusOrder[a.status] === statusOrder[b.status]) {
                                        return a.name.localeCompare(b.name);
                                    }
                                    return statusOrder[a.status] - statusOrder[b.status];
                                }
                            });
                        }
                        
                        if (filteredSeries.length === 0) {
                            const emptyState = document.createElement('div');
                            emptyState.className = 'empty-state';
                            emptyState.textContent = 'Aucune série ne correspond aux filtres';
                            seriesList.appendChild(emptyState);
                        } else {
                            // Tri normal si le filtre n'est pas "Tous"
                            if (statusFilter !== 'all') {
                                if (sortBy === 'last-updated') {
                                    filteredSeries.sort((a, b) => b.lastUpdated - a.lastUpdated);
                                } else {
                                    filteredSeries.sort((a, b) => a.name.localeCompare(b.name));
                                }
                            }
                            
                            filteredSeries.forEach(seriesItem => {
                                const seriesElement = document.createElement('li');
                                seriesElement.className = 'series-item';
                                seriesElement.dataset.status = seriesItem.status;
                                
                                const seriesInfo = document.createElement('div');
                                seriesInfo.className = 'series-info';
                                
                                const seriesName = document.createElement('div');
                                seriesName.className = 'series-name';
                                seriesName.textContent = seriesItem.name;
                                seriesName.addEventListener('click', () => {
                                    editSeries(seriesItem, tab, categoryName);
                                });
                                
                                const seriesCounters = document.createElement('div');
                                seriesCounters.className = 'series-counters';
                                
                                // Premier compteur
                                const counter1Group = document.createElement('div');
                                counter1Group.className = 'counter-group';
                                
                                const counter1Label = document.createElement('span');
                                counter1Label.className = 'counter-label';
                                counter1Label.textContent = getCounterText(seriesItem.counter1Type) + ':';
                                
                                const counter1Controls = document.createElement('div');
                                counter1Controls.className = 'counter-controls';
                                
                                const decreaseBtn1 = document.createElement('button');
                                decreaseBtn1.className = 'counter-btn';
                                decreaseBtn1.textContent = '-';
                                decreaseBtn1.addEventListener('click', (e) => {
                                    e.stopPropagation();
                                    if (seriesItem.counter1Value > 0) {
                                        seriesItem.counter1Value--;
                                        seriesItem.lastUpdated = Date.now();
                                        updateCounterDisplay(counter1Value, seriesItem.counter1Value);
                                        saveData();
                                        renderCategories();
                                    }
                                });
                                
                                const counter1Value = document.createElement('span');
                                counter1Value.className = 'counter-value';
                                counter1Value.textContent = seriesItem.counter1Value;
                                counter1Value.addEventListener('click', (e) => {
                                    e.stopPropagation();
                                    editCounter(seriesItem, tab, categoryName, 1);
                                });
                                
                                const increaseBtn1 = document.createElement('button');
                                increaseBtn1.className = 'counter-btn';
                                increaseBtn1.textContent = '+';
                                increaseBtn1.addEventListener('click', (e) => {
                                    e.stopPropagation();
                                    seriesItem.counter1Value++;
                                    seriesItem.lastUpdated = Date.now();
                                    updateCounterDisplay(counter1Value, seriesItem.counter1Value);
                                    saveData();
                                    renderCategories();
                                });
                                
                                counter1Controls.appendChild(decreaseBtn1);
                                counter1Controls.appendChild(counter1Value);
                                counter1Controls.appendChild(increaseBtn1);
                                
                                counter1Group.appendChild(counter1Label);
                                counter1Group.appendChild(counter1Controls);
                                seriesCounters.appendChild(counter1Group);
                                
                                // Deuxième compteur (si existant)
                                if (seriesItem.counter2Type && seriesItem.counter2Value !== null) {
                                    const counter2Group = document.createElement('div');
                                    counter2Group.className = 'counter-group';
                                    
                                    const counter2Label = document.createElement('span');
                                    counter2Label.className = 'counter-label';
                                    counter2Label.textContent = getCounterText(seriesItem.counter2Type) + ':';
                                    
                                    const counter2Controls = document.createElement('div');
                                    counter2Controls.className = 'counter-controls';
                                    
                                    const decreaseBtn2 = document.createElement('button');
                                    decreaseBtn2.className = 'counter-btn';
                                    decreaseBtn2.textContent = '-';
                                    decreaseBtn2.addEventListener('click', (e) => {
                                        e.stopPropagation();
                                        if (seriesItem.counter2Value > 0) {
                                            seriesItem.counter2Value--;
                                            seriesItem.lastUpdated = Date.now();
                                            updateCounterDisplay(counter2Value, seriesItem.counter2Value);
                                            saveData();
                                            renderCategories();
                                        }
                                    });
                                    
                                    const counter2Value = document.createElement('span');
                                    counter2Value.className = 'counter-value';
                                    counter2Value.textContent = seriesItem.counter2Value;
                                    counter2Value.addEventListener('click', (e) => {
                                        e.stopPropagation();
                                        editCounter(seriesItem, tab, categoryName, 2);
                                    });
                                    
                                    const increaseBtn2 = document.createElement('button');
                                    increaseBtn2.className = 'counter-btn';
                                    increaseBtn2.textContent = '+';
                                    increaseBtn2.addEventListener('click', (e) => {
                                        e.stopPropagation();
                                        seriesItem.counter2Value++;
                                        seriesItem.lastUpdated = Date.now();
                                        updateCounterDisplay(counter2Value, seriesItem.counter2Value);
                                        saveData();
                                        renderCategories();
                                    });
                                    
                                    counter2Controls.appendChild(decreaseBtn2);
                                    counter2Controls.appendChild(counter2Value);
                                    counter2Controls.appendChild(increaseBtn2);
                                    
                                    counter2Group.appendChild(counter2Label);
                                    counter2Group.appendChild(counter2Controls);
                                    seriesCounters.appendChild(counter2Group);
                                }
                                
                                const seriesActions = document.createElement('div');
                                seriesActions.className = 'series-actions';
                                
                                const seriesStatus = document.createElement('div');
                                seriesStatus.className = `series-status status-${seriesItem.status}`;
                                seriesStatus.textContent = getStatusText(seriesItem.status);
                                seriesStatus.addEventListener('click', () => {
                                    const statuses = ['ongoing', 'todo', 'finished', 'dropped'];
                                    const currentIndex = statuses.indexOf(seriesItem.status);
                                    const nextIndex = (currentIndex + 1) % statuses.length;
                                    seriesItem.status = statuses[nextIndex];
                                    seriesItem.lastUpdated = Date.now();
                                    seriesStatus.className = `series-status status-${seriesItem.status}`;
                                    seriesStatus.textContent = getStatusText(seriesItem.status);
                                    saveData();
                                    renderCategories();
                                });
                                
                                const editSeriesBtn = document.createElement('button');
                                editSeriesBtn.className = 'edit-series';
                                editSeriesBtn.innerHTML = '<i class="fas fa-edit"></i>';
                                editSeriesBtn.addEventListener('click', () => {
                                    editSeries(seriesItem, tab, categoryName);
                                });
                                
                                const deleteSeriesBtn = document.createElement('button');
                                deleteSeriesBtn.className = 'delete-series';
                                deleteSeriesBtn.innerHTML = '<i class="fas fa-times"></i>';
                                deleteSeriesBtn.addEventListener('click', () => {
                                    confirmDeleteSeries(seriesItem.id, tab, categoryName, seriesItem.name);
                                });
                                
                                seriesActions.appendChild(seriesStatus);
                                seriesActions.appendChild(editSeriesBtn);
                                seriesActions.appendChild(deleteSeriesBtn);
                                
                                seriesInfo.appendChild(seriesName);
                                seriesInfo.appendChild(seriesCounters);
                                
                                seriesElement.appendChild(seriesInfo);
                                seriesElement.appendChild(seriesActions);
                                
                                seriesList.appendChild(seriesElement);
                            });
                        }
                        
                        categoryElement.appendChild(seriesList);
                        categoriesContainer.appendChild(categoryElement);
                    }
                } else {
                    categoriesContainer.innerHTML = '<div class="empty-state">Aucune catégorie pour le moment. Ajoutez-en une!</div>';
                }
            });
        }

        function updateCounterDisplay(element, count) {
            element.textContent = count;
        }

        // Modifier la valeur du compteur manuellement
        function editCounter(seriesItem, type, category, counterNumber) {
            seriesToEditCounter = { seriesItem, type, category, counterNumber };
            const counterModal = document.getElementById('counter-modal');
            const counter1Input = document.getElementById('counter1-input');
            const counter2Input = document.getElementById('counter2-input');
            const counter1Label = document.getElementById('counter1-label');
            const counter2Label = document.getElementById('counter2-label');
            const counter2ModalGroup = document.getElementById('counter2-modal-group');
            
            if (counterNumber === 1) {
                counter1Label.textContent = getFullCounterText(seriesItem.counter1Type) + ':';
                counter1Input.value = seriesItem.counter1Value;
                counter2ModalGroup.style.display = 'none';
            } else {
                counter1Label.textContent = getFullCounterText(seriesItem.counter1Type) + ':';
                counter1Input.value = seriesItem.counter1Value;
                counter2Label.textContent = getFullCounterText(seriesItem.counter2Type) + ':';
                counter2Input.value = seriesItem.counter2Value;
                counter2ModalGroup.style.display = 'block';
            }
            
            counterModal.style.display = 'flex';
            counter1Input.focus();
        }

        // Modifier les détails d'une série
        function editSeries(seriesItem, type, category) {
            seriesToEdit = { seriesItem, type, category };
            const editModal = document.getElementById('edit-series-modal');
            const editName = document.getElementById('edit-series-name');
            const editCounter1Type = document.getElementById('edit-counter1-type');
            const editCounter1Value = document.getElementById('edit-counter1-value');
            const editCounter2Type = document.getElementById('edit-counter2-type');
            const editCounter2Value = document.getElementById('edit-counter2-value');
            const editStatus = document.getElementById('edit-series-status');
            const editCounter2Container = document.getElementById('edit-counter2-container');
            const editCounter2ValueContainer = document.getElementById('edit-counter2-value-container');
            
            editName.value = seriesItem.name;
            editCounter1Type.value = seriesItem.counter1Type;
            editCounter1Value.value = seriesItem.counter1Value;
            editCounter2Type.value = seriesItem.counter2Type || 'episodes';
            editCounter2Value.value = seriesItem.counter2Value || 0;
            editStatus.value = seriesItem.status;
            
            // Afficher ou masquer les champs du deuxième compteur
            if (seriesItem.counter2Type && seriesItem.counter2Value !== null) {
                editCounter2Container.style.display = 'block';
                editCounter2ValueContainer.style.display = 'block';
            } else {
                editCounter2Container.style.display = 'none';
                editCounter2ValueContainer.style.display = 'none';
            }
            
            // Gérer le changement de type de compteur principal
            editCounter1Type.addEventListener('change', () => {
                if (editCounter1Type.value === 'seasons' || editCounter1Type.value === 'volumes') {
                    editCounter2Container.style.display = 'block';
                    editCounter2ValueContainer.style.display = 'block';
                    if (editCounter1Type.value === 'seasons') {
                        editCounter2Type.value = 'episodes';
                    } else {
                        editCounter2Type.value = 'chapters';
                    }
                } else {
                    editCounter2Container.style.display = 'none';
                    editCounter2ValueContainer.style.display = 'none';
                }
            });
            
            editModal.style.display = 'flex';
            editName.focus();
        }

        // Confirmer la suppression d'une série
        function confirmDeleteSeries(seriesId, type, category, seriesName) {
            seriesToDelete = { seriesId, type, category };
            const deleteModal = document.getElementById('delete-modal');
            const deleteMessage = document.getElementById('delete-message');
            
            deleteMessage.textContent = `Êtes-vous sûr de vouloir supprimer la série "${seriesName}"?`;
            deleteModal.style.display = 'flex';
        }

        // Confirmer la suppression d'une catégorie
        function confirmDeleteCategory(type, category) {
            categoryToDelete = { type, category };
            const deleteModal = document.getElementById('delete-modal');
            const deleteMessage = document.getElementById('delete-message');
            
            deleteMessage.textContent = `Êtes-vous sûr de vouloir supprimer la catégorie "${category}"? Toutes les séries qu'elle contient seront également supprimées.`;
            deleteModal.style.display = 'flex';
        }

        // Supprimer une série
        function deleteSeries(seriesId, type, category) {
            if (appData[type] && appData[type][category]) {
                appData[type][category] = appData[type][category].filter(series => series.id !== seriesId);
                saveData();
                renderCategories();
            }
        }

        // Supprimer une catégorie
        function deleteCategory(type, category) {
            if (appData[type] && appData[type][category]) {
                delete appData[type][category];
                saveData();
                renderCategories();
                updateCategoryOptions();
            }
        }

        // Gestion des onglets
        function setupTabs() {
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    // Désactiver tous les onglets
                    tabs.forEach(t => t.classList.remove('active'));
                    // Activer l'onglet cliqué
                    tab.classList.add('active');
                    
                    // Cacher tous les contenus
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    // Afficher le contenu correspondant
                    const tabName = tab.getAttribute('data-tab');
                    document.getElementById(`${tabName}-content`).classList.add('active');
                    
                    // Mettre à jour les options de catégorie dans le formulaire d'ajout de série
                    updateCategoryOptions();
                });
            });
        }

        // Mettre à jour les options de catégorie dans le formulaire d'ajout de série
        function updateCategoryOptions() {
            const seriesCategorySelect = document.getElementById('series-category');
            const activeTab = document.querySelector('.tab.active').getAttribute('data-tab');
            
            // Vider les options existantes
            seriesCategorySelect.innerHTML = '';
            
            // Ajouter les catégories de l'onglet actif
            if (appData[activeTab]) {
                Object.keys(appData[activeTab]).forEach(category => {
                    const option = document.createElement('option');
                    option.value = category;
                    option.textContent = category;
                    seriesCategorySelect.appendChild(option);
                });
            }
            
            // Si aucune catégorie n'existe, ajouter un message
            if (seriesCategorySelect.options.length === 0) {
                const option = document.createElement('option');
                option.value = '';
                option.textContent = 'Aucune catégorie disponible - Créez-en d\'abord';
                seriesCategorySelect.appendChild(option);
                seriesCategorySelect.disabled = true;
            } else {
                seriesCategorySelect.disabled = false;
            }
        }

        // Gestion des modals
        function setupModals() {
            // Modal d'ajout de catégorie
            const categoryModal = document.getElementById('category-modal');
            const addCategoryBtn = document.getElementById('add-category');
            const categoryClose = categoryModal.querySelector('.close');
            const categoryForm = document.getElementById('category-form');
            
            addCategoryBtn.addEventListener('click', () => {
                categoryModal.style.display = 'flex';
            });
            
            categoryClose.addEventListener('click', () => {
                categoryModal.style.display = 'none';
            });
            
            categoryForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const type = document.getElementById('category-type').value;
                const name = document.getElementById('category-name').value;
                
                if (!appData[type]) {
                    appData[type] = {};
                }
                
                if (!appData[type][name]) {
                    appData[type][name] = [];
                    saveData();
                    renderCategories();
                    updateCategoryOptions();
                    categoryModal.style.display = 'none';
                    categoryForm.reset();
                } else {
                    alert('Cette catégorie existe déjà pour ce type!');
                }
            });
            
            // Modal d'ajout de série
            const seriesModal = document.getElementById('series-modal');
            const addSeriesBtn = document.getElementById('add-series');
            const seriesClose = seriesModal.querySelector('.close');
            const seriesForm = document.getElementById('series-form');
            const seriesTypeSelect = document.getElementById('series-type');
            const counter1TypeSelect = document.getElementById('series-counter1-type');
            const counter2Container = document.getElementById('counter2-container');
            const counter2ValueContainer = document.getElementById('counter2-value-container');
            
            // Gérer l'affichage des champs de compteur secondaire
            counter1TypeSelect.addEventListener('change', () => {
                if (counter1TypeSelect.value === 'seasons' || counter1TypeSelect.value === 'volumes') {
                    counter2Container.style.display = 'block';
                    counter2ValueContainer.style.display = 'block';
                    // Définir le type de compteur secondaire par défaut
                    document.getElementById('series-counter2-type').value = 
                        counter1TypeSelect.value === 'seasons' ? 'episodes' : 'chapters';
                } else {
                    counter2Container.style.display = 'none';
                    counter2ValueContainer.style.display = 'none';
                }
            });
            
            // Définir le type de compteur secondaire en fonction du type de média
            seriesTypeSelect.addEventListener('change', () => {
                if (seriesTypeSelect.value === 'anime') {
                    counter1TypeSelect.value = 'seasons';
                    counter2Container.style.display = 'block';
                    counter2ValueContainer.style.display = 'block';
                    document.getElementById('series-counter2-type').value = 'episodes';
                } else if (seriesTypeSelect.value === 'novel') {
                    counter1TypeSelect.value = 'volumes';
                    counter2Container.style.display = 'block';
                    counter2ValueContainer.style.display = 'block';
                    document.getElementById('series-counter2-type').value = 'chapters';
                } else {
                    counter1TypeSelect.value = 'chapters';
                    counter2Container.style.display = 'none';
                    counter2ValueContainer.style.display = 'none';
                }
            });
            
            addSeriesBtn.addEventListener('click', () => {
                updateCategoryOptions();
                seriesModal.style.display = 'flex';
            });
            
            seriesClose.addEventListener('click', () => {
                seriesModal.style.display = 'none';
            });
            
            seriesForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const type = document.getElementById('series-type').value;
                const category = document.getElementById('series-category').value;
                const name = document.getElementById('series-name').value;
                const counter1Type = document.getElementById('series-counter1-type').value;
                const counter1Value = parseInt(document.getElementById('series-counter1').value);
                const counter2Type = document.getElementById('series-counter2-type').value;
                const counter2Value = parseInt(document.getElementById('series-counter2').value);
                const status = document.getElementById('series-status').value;
                
                if (appData[type] && appData[type][category]) {
                    // Vérifier si la série existe déjà
                    const exists = appData[type][category].some(series => series.name === name);
                    
                    if (!exists) {
                        const newSeries = {
                            id: generateId(),
                            name,
                            counter1Type,
                            counter1Value,
                            status,
                            lastUpdated: Date.now()
                        };
                        
                        // Ajouter le deuxième compteur si nécessaire
                        if (counter1Type === 'seasons' || counter1Type === 'volumes') {
                            newSeries.counter2Type = counter2Type;
                            newSeries.counter2Value = counter2Value;
                        } else {
                            newSeries.counter2Type = null;
                            newSeries.counter2Value = null;
                        }
                        
                        appData[type][category].push(newSeries);
                        
                        saveData();
                        renderCategories();
                        seriesModal.style.display = 'none';
                        seriesForm.reset();
                    } else {
                        alert('Cette série existe déjà dans cette catégorie!');
                    }
                }
            });
            
            // Modal de suppression
            const deleteModal = document.getElementById('delete-modal');
            const cancelDeleteBtn = document.getElementById('cancel-delete');
            const confirmDeleteBtn = document.getElementById('confirm-delete');
            const deleteClose = deleteModal.querySelector('.close');
            
            cancelDeleteBtn.addEventListener('click', () => {
                deleteModal.style.display = 'none';
                seriesToDelete = null;
                categoryToDelete = null;
            });
            
            deleteClose.addEventListener('click', () => {
                deleteModal.style.display = 'none';
                seriesToDelete = null;
                categoryToDelete = null;
            });
            
            confirmDeleteBtn.addEventListener('click', () => {
                if (seriesToDelete) {
                    deleteSeries(seriesToDelete.seriesId, seriesToDelete.type, seriesToDelete.category);
                    seriesToDelete = null;
                } else if (categoryToDelete) {
                    deleteCategory(categoryToDelete.type, categoryToDelete.category);
                    categoryToDelete = null;
                }
                deleteModal.style.display = 'none';
            });
            
            // Modal de modification du compteur
            const counterModal = document.getElementById('counter-modal');
            const cancelCounterBtn = document.getElementById('cancel-counter');
            const saveCounterBtn = document.getElementById('save-counter');
            const counterClose = counterModal.querySelector('.close');
            const counter1Input = document.getElementById('counter1-input');
            const counter2Input = document.getElementById('counter2-input');
            
            cancelCounterBtn.addEventListener('click', () => {
                counterModal.style.display = 'none';
                seriesToEditCounter = null;
            });
            
            counterClose.addEventListener('click', () => {
                counterModal.style.display = 'none';
                seriesToEditCounter = null;
            });
            
            saveCounterBtn.addEventListener('click', () => {
                if (seriesToEditCounter) {
                    const newValue1 = parseInt(counter1Input.value);
                    let newValue2 = parseInt(counter2Input.value);
                    
                    if (!isNaN(newValue1) && newValue1 >= 0) {
                        if (seriesToEditCounter.counterNumber === 1) {
                            seriesToEditCounter.seriesItem.counter1Value = newValue1;
                        } else {
                            seriesToEditCounter.seriesItem.counter1Value = newValue1;
                            if (!isNaN(newValue2) && newValue2 >= 0) {
                                seriesToEditCounter.seriesItem.counter2Value = newValue2;
                            }
                        }
                        seriesToEditCounter.seriesItem.lastUpdated = Date.now();
                        saveData();
                        renderCategories();
                    }
                    counterModal.style.display = 'none';
                    seriesToEditCounter = null;
                }
            });
            
            counter1Input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    saveCounterBtn.click();
                }
            });
            
            counter2Input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    saveCounterBtn.click();
                }
            });
            
            // Modal de modification de série
            const editSeriesModal = document.getElementById('edit-series-modal');
            const cancelEditSeriesBtn = document.getElementById('cancel-edit-series');
            const editSeriesForm = document.getElementById('edit-series-form');
            const editSeriesClose = editSeriesModal.querySelector('.close');
            const editCounter1Type = document.getElementById('edit-counter1-type');
            const editCounter2Container = document.getElementById('edit-counter2-container');
            const editCounter2ValueContainer = document.getElementById('edit-counter2-value-container');
            
            // Gérer l'affichage des champs de compteur secondaire
            editCounter1Type.addEventListener('change', () => {
                if (editCounter1Type.value === 'seasons' || editCounter1Type.value === 'volumes') {
                    editCounter2Container.style.display = 'block';
                    editCounter2ValueContainer.style.display = 'block';
                    // Définir le type de compteur secondaire par défaut
                    document.getElementById('edit-counter2-type').value = 
                        editCounter1Type.value === 'seasons' ? 'episodes' : 'chapters';
                } else {
                    editCounter2Container.style.display = 'none';
                    editCounter2ValueContainer.style.display = 'none';
                }
            });
            
            cancelEditSeriesBtn.addEventListener('click', () => {
                editSeriesModal.style.display = 'none';
                seriesToEdit = null;
            });
            
            editSeriesClose.addEventListener('click', () => {
                editSeriesModal.style.display = 'none';
                seriesToEdit = null;
            });
            
            editSeriesForm.addEventListener('submit', (e) => {
                e.preventDefault();
                if (seriesToEdit) {
                    const newName = document.getElementById('edit-series-name').value;
                    const newCounter1Type = document.getElementById('edit-counter1-type').value;
                    const newCounter1Value = parseInt(document.getElementById('edit-counter1-value').value);
                    const newCounter2Type = document.getElementById('edit-counter2-type').value;
                    const newCounter2Value = parseInt(document.getElementById('edit-counter2-value').value);
                    const newStatus = document.getElementById('edit-series-status').value;
                    
                    if (newName && !isNaN(newCounter1Value) && newCounter1Value >= 0) {
                        seriesToEdit.seriesItem.name = newName;
                        seriesToEdit.seriesItem.counter1Type = newCounter1Type;
                        seriesToEdit.seriesItem.counter1Value = newCounter1Value;
                        seriesToEdit.seriesItem.status = newStatus;
                        seriesToEdit.seriesItem.lastUpdated = Date.now();
                        
                        // Gérer le deuxième compteur
                        if (newCounter1Type === 'seasons' || newCounter1Type === 'volumes') {
                            seriesToEdit.seriesItem.counter2Type = newCounter2Type;
                            seriesToEdit.seriesItem.counter2Value = newCounter2Value;
                        } else {
                            seriesToEdit.seriesItem.counter2Type = null;
                            seriesToEdit.seriesItem.counter2Value = null;
                        }
                        
                        saveData();
                        renderCategories();
                        editSeriesModal.style.display = 'none';
                        seriesToEdit = null;
                    }
                }
            });
            
            // Fermer les modals en cliquant à l'extérieur
            window.addEventListener('click', (e) => {
                if (e.target === categoryModal) {
                    categoryModal.style.display = 'none';
                }
                if (e.target === seriesModal) {
                    seriesModal.style.display = 'none';
                }
                if (e.target === deleteModal) {
                    deleteModal.style.display = 'none';
                    seriesToDelete = null;
                    categoryToDelete = null;
                }
                if (e.target === counterModal) {
                    counterModal.style.display = 'none';
                    seriesToEditCounter = null;
                }
                if (e.target === editSeriesModal) {
                    editSeriesModal.style.display = 'none';
                    seriesToEdit = null;
                }
            });
        }

        // Configuration des filtres
        function setupFilters() {
            const statusFilter = document.getElementById('status-filter');
            const sortSelect = document.getElementById('sort');
            
            statusFilter.addEventListener('change', renderCategories);
            sortSelect.addEventListener('change', renderCategories);
        }

        // Initialisation de l'application
        function initApp() {
            loadData();
            setupTabs();
            setupModals();
            setupFilters();
            renderCategories();
            updateCategoryOptions();
        }

        // Démarrer l'application quand la page est chargée
        document.addEventListener('DOMContentLoaded', initApp);
    </script>

    <div class="sync-section">
            <button class="sync-btn sync-google" id="sync-google">
                <i class="fab fa-google-drive"></i> Synchroniser avec Google Drive
            </button>
            <button class="sync-btn sync-local" id="sync-local">
                <i class="fas fa-download"></i> Charger depuis le stockage local
            </button>
        </div>
        <div class="sync-status" id="sync-status"></div>
    </div>

    <script>
        // Remplacez par votre propre Client ID
        const CLIENT_ID = '701190629301-bho47q5g0tq2bm4mg9pho7886lrusicb.apps.googleusercontent.com';
        const DISCOVERY_DOC = 'https://www.googleapis.com/discovery/v1/apis/drive/v3/rest';
        const SCOPES = 'https://www.googleapis.com/auth/drive.file';
        
        let tokenClient;
        let gapiInited = false;
        let gisInited = false;
        
        // Initialiser gapi
        function gapiLoaded() {
            gapi.load('client', initializeGapiClient);
        }
        
        // Initialiser le client gapi
        async function initializeGapiClient() {
            await gapi.client.init({
                apiKey: API_KEY,
                discoveryDocs: [DISCOVERY_DOC],
            });
            gapiInited = true;
            maybeEnableButtons();
        }
        
        // Initialiser Google Identity Services
        function gisLoaded() {
            tokenClient = google.accounts.oauth2.initTokenClient({
                client_id: CLIENT_ID,
                scope: SCOPES,
                callback: '', // défini plus tard
            });
            gisInited = true;
            maybeEnableButtons();
        }
        
        function maybeEnableButtons() {
            if (gapiInited && gisInited) {
                document.getElementById('sync-google').style.visibility = 'visible';
            }
        }
        
        // Gérer l'authentification
        async function handleAuthClick() {
            const statusElement = document.getElementById('sync-status');
            statusElement.textContent = 'Authentification en cours...';
            
            tokenClient.callback = async (resp) => {
                if (resp.error !== undefined) {
                    statusElement.textContent = 'Erreur d\'authentification: ' + resp.error;
                    throw resp;
                }
                statusElement.textContent = 'Authentification réussie!';
                await syncToGoogleDrive();
            };
            
            if (gapi.client.getToken() === null) {
                tokenClient.requestAccessToken({prompt: 'consent'});
            } else {
                tokenClient.requestAccessToken({prompt: ''});
            }
        }
        
        // Synchroniser vers Google Drive
        async function syncToGoogleDrive() {
            const statusElement = document.getElementById('sync-status');
            statusElement.textContent = 'Synchronisation avec Google Drive...';
            
            try {
                // Vérifier si le fichier existe déjà
                let fileId = await findFile();
                const data = JSON.stringify(appData);
                
                if (fileId) {
                    // Mettre à jour le fichier existant
                    await updateFile(fileId, data);
                    statusElement.textContent = 'Données mises à jour sur Google Drive!';
                } else {
                    // Créer un nouveau fichier
                    await createFile(data);
                    statusElement.textContent = 'Données sauvegardées sur Google Drive!';
                }
                
                // Sauvegarder aussi en local
                saveData();
            } catch (error) {
                console.error('Erreur de synchronisation:', error);
                statusElement.textContent = 'Erreur de synchronisation: ' + error.message;
            }
        }
        
        // Trouver le fichier sur Google Drive
        async function findFile() {
            try {
                // Vérifier que l'API Drive est disponible
                if (!gapi.client.drive) {
                    // Charger l'API Drive si ce n'est pas fait
                    await gapi.client.load('drive', 'v3');
                }
                
                const response = await gapi.client.drive.files.list({
                    q: "name='seriesTrackerData.json' and trashed=false",
                    fields: 'files(id, name)',
                    spaces: 'drive',
                });
                
                if (response.result.files.length > 0) {
                    return response.result.files[0].id;
                }
                return null;
            } catch (error) {
                console.error("Erreur lors de la recherche du fichier:", error);
                throw new Error("Impossible de rechercher le fichier: " + error.message);
            }
        }
        
        // Créer un nouveau fichier
        async function createFile(data) {
            const fileMetadata = {
                name: 'seriesTrackerData.json',
                mimeType: 'application/json',
            };
            
            const form = new FormData();
            form.append('metadata', new Blob([JSON.stringify(fileMetadata)], {type: 'application/json'}));
            form.append('file', new Blob([data], {type: 'application/json'}));
            
            const response = await fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart', {
                method: 'POST',
                headers: new Headers({'Authorization': 'Bearer ' + gapi.client.getToken().access_token}),
                body: form,
            });
            
            return response.json();
        }
        
        // Mettre à jour un fichier existant
        async function updateFile(fileId, data) {
            const form = new FormData();
            form.append('file', new Blob([data], {type: 'application/json'}));
            
            const response = await fetch(`https://www.googleapis.com/upload/drive/v3/files/${fileId}?uploadType=multipart`, {
                method: 'PATCH',
                headers: new Headers({'Authorization': 'Bearer ' + gapi.client.getToken().access_token}),
                body: form,
            });
            
            return response.json();
        }
        
        // Charger depuis Google Drive
        async function loadFromGoogleDrive() {
            const statusElement = document.getElementById('sync-status');
            statusElement.textContent = 'Chargement depuis Google Drive...';
            
            try {
                const fileId = await findFile();
                
                if (!fileId) {
                    statusElement.textContent = 'Aucun fichier trouvé sur Google Drive';
                    return;
                }
                
                const response = await gapi.client.drive.files.get({
                    fileId: fileId,
                    alt: 'media'
                });
                
                if (response.body) {
                    appData = JSON.parse(response.body);
                    saveData();
                    renderCategories();
                    statusElement.textContent = 'Données chargées depuis Google Drive!';
                }
            } catch (error) {
                console.error('Erreur de chargement:', error);
                statusElement.textContent = 'Erreur de chargement: ' + error.message;
            }
        }
        
        // Charger depuis le stockage local
        function loadFromLocalStorage() {
            const statusElement = document.getElementById('sync-status');
            loadData();
            renderCategories();
            statusElement.textContent = 'Données chargées depuis le stockage local!';
        }
        
        // Événements
        document.getElementById('sync-google').addEventListener('click', handleAuthClick);
        document.getElementById('sync-local').addEventListener('click', loadFromLocalStorage);
        
        // Initialiser les API Google
        window.gapiLoaded = gapiLoaded;
        window.gisLoaded = gisLoaded;
    </script>
    
    <!-- Charger les API Google -->
    <script src="https://accounts.google.com/gsi/client" onload="gisLoaded()"></script>
    <script src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script>

</body>
</html>
